---
description: "Gestion des fonctions Asynchrones, quelques bonnes pratiques."
---
# üìò Fonction asynchrone

```javascript copy
export default async function getContent(pathArray: string[]) {
    const filePath = `./${pathArray.join('/')}/`;
    // Construire le chemin complet du fichier

    try {
        const { seo }: { seo: Metadata } = await import(`${filePath}seo.ts`);
        const { cards }: { cards: card[] } = await import(`${filePath}cards.ts`);
        const { services }: { services: ServicesItem } = await import(`${filePath}services.ts`);
        const { hero }: { hero: heroType } = await import(`${filePath}hero.ts`);
        const success = { cards, services, hero, seo }
        return [success, null];

    } catch (error) {
        console.error(`Failed to load module at ${filePath}:`, error);
        return [null, error];
    }
}
```

## üìò **1. Fonctionnement du Code**

### üìò **a) Objectif de la fonction**
La fonction `getContent` :
1. **Construit dynamiquement un chemin de fichier** en utilisant les √©l√©ments d‚Äôun tableau (`pathArray`).
2. **Charge des modules TypeScript dynamiques** situ√©s dans ce chemin (ex. `seo.ts`, `cards.ts`, etc.).
3. Renvoie un objet consolid√© contenant les donn√©es de ces modules sous forme de **promesse**.

---

### üìò **b) √âtapes principales**

1. **Construction du chemin dynamique**  
   Le chemin du fichier est cr√©√© en joignant les √©l√©ments du tableau `pathArray` avec `/`.  
   Exemple : 
   ```typescript copy
   const pathArray = ['pages', 'about'];
   const filePath = `./${pathArray.join('/')}/`; // R√©sultat : "./pages/about/"
   ```

2. **Chargement dynamique avec `import()`**
   Les fichiers suivants sont import√©s dynamiquement :
   - `seo.ts` : suppos√© contenir des m√©tadonn√©es SEO.
   - `cards.ts` : suppos√© contenir une liste de cartes.
   - `services.ts` : suppos√© contenir des informations sur les services.
   - `hero.ts` : suppos√© contenir des donn√©es pour la section h√©ro√Øque.  
   Chaque module est import√© avec une structure sp√©cifique pour assurer le typage (`Metadata`, `card[]`, etc.).

3. **Gestion des erreurs**
   Si un des modules ne peut pas √™tre charg√© (fichier manquant, erreur de syntaxe, etc.), une erreur est captur√©e et le code :
   - Affiche un message dans la console (`console.error`).
   - Retourne un tableau `[null, error]` pour signaler l‚Äô√©chec.

4. **R√©sultat consolid√©**
   Si tout se passe bien, un objet nomm√© `success` est cr√©√© contenant toutes les donn√©es charg√©es :  
   ```typescript copy
   const success = { cards, services, hero, seo };
   ```
   Et la fonction retourne ce r√©sultat sous forme de tableau `[success, null]`.

---

## üìò **2. Comment l‚Äôutiliser**

Voici un exemple pratique d‚Äôutilisation de cette fonction dans une application.

### üìò **a) Appeler la fonction**
```typescript copy
import getContent from './getContent';

(async () => {
    const [data, error] = await getContent(['pages', 'about']);

    if (error) {
        console.error("Erreur lors du chargement du contenu :", error);
        return;
    }

    console.log("Donn√©es charg√©es :", data);
})();
```

---

### üìò **b) Explication de l'exemple**
1. **Appel avec un chemin**  
   Le tableau `['pages', 'about']` indique que les fichiers se trouvent dans le dossier `./pages/about/`.

2. **R√©sultat attendu**
   - Si les fichiers `seo.ts`, `cards.ts`, `services.ts` et `hero.ts` existent, les donn√©es des fichiers sont regroup√©es dans l‚Äôobjet renvoy√©.
   - Si un fichier est manquant ou une erreur se produit, celle-ci est g√©r√©e gr√¢ce au second √©l√©ment de la r√©ponse, `error`.

3. **Structure des donn√©es renvoy√©es**
   Exemple de donn√©es renvoy√©es si tout fonctionne :
   ```javascript copy
     seo: { title: "About Page", description: "About us page SEO metadata" },
     cards: [
       { id: 1, title: "Card 1", content: "Content for card 1" },
       { id: 2, title: "Card 2", content: "Content for card 2" }
     ],
     services: { id: 123, name: "Service Example" },
     hero: { title: "Welcome to About Page", subtitle: "Learn more about us" }
   }
   ```

4. **Gestion des erreurs**
   Si un fichier est introuvable, par exemple `seo.ts`, la fonction capture cette erreur et renvoie :
   ```javascript copy
   [null, Error: "Failed to load module at ./pages/about/seo.ts"]
   ```

---

### üìò **c) Cas d'utilisation**
Ce type de fonction est utile dans les contextes suivants :
- **Applications modulaires** : o√π chaque section ou page a ses propres fichiers de donn√©es.
- **CMS headless** : pour charger dynamiquement du contenu bas√© sur des routes ou des pages.
- **Sites statiques ou g√©n√©rateurs de pages** : pour consolider des donn√©es au moment du rendu.

---

**Attention** :  
- Assurez-vous que le dossier cible existe et contient les fichiers n√©cessaires.  
- Les fichiers doivent √™tre export√©s correctement avec les noms pr√©vus (ex. `export const seo = ...`).  
- `import()` est une m√©thode asynchrone, compatible avec ES6+ et certaines versions de Node.js.