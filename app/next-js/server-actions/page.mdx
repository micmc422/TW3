# ğŸš€ **Server Actions dans Next.js 13+ : Le Remplacement des API Routes**  

Avec lâ€™introduction de **Server Actions** dans Next.js 13+, on assiste Ã  un **changement majeur** dans la gestion des actions cÃ´tÃ© serveur, remplaÃ§ant progressivement les API Routes.  

---

## **ğŸ“Œ 1ï¸âƒ£ Qu'est-ce qu'une Server Action ?**  

Les **Server Actions** permettent dâ€™exÃ©cuter des **fonctions cÃ´tÃ© serveur directement depuis les composants React** sans avoir besoin de crÃ©er une route API distincte.  

âœ… **Avantages** :
- Plus besoin de dÃ©finir des API Routes (`pages/api/*` ou `app/api/*`).
- RÃ©duction des allers-retours client-serveur.
- SÃ©curitÃ© renforcÃ©e : **les actions ne sont pas exposÃ©es cÃ´tÃ© client**.
- SimplicitÃ© et meilleure lisibilitÃ© du code.

ğŸ”¹ **Comparaison** :  

| API Routes (`app/api/*`) | Server Actions (`use server`) |
|----------------|----------------|
| NÃ©cessite une route sÃ©parÃ©e (`app/api/...`) | Directement dÃ©finie dans les composants |
| Requiert un appel fetch cÃ´tÃ© client | Peut Ãªtre appelÃ©e comme une fonction normale |
| Doit gÃ©rer la validation et lâ€™Ã©tat cÃ´tÃ© client | GÃ¨re tout sur le serveur automatiquement |

---

## **ğŸ“Œ 2ï¸âƒ£ Comment utiliser les Server Actions ?**  

### **ğŸŒ DÃ©finir une Server Action**  

Next.js introduit le mot-clÃ© **`"use server"`** pour dÃ©clarer une fonction exÃ©cutÃ©e cÃ´tÃ© serveur.  

ğŸ”¹ **Exemple : Ajouter un commentaire Ã  une base de donnÃ©es**  

ğŸ›  **Fichier : `app/comments/page.tsx`**  
```tsx
"use client";

import { useState } from "react";

export default function CommentsPage() {
  const [comment, setComment] = useState("");
  const [status, setStatus] = useState("");

  async function submitComment(formData: FormData) {
    setStatus("Envoi en cours...");
    const response = await fetch("/actions/addComment", {
      method: "POST",
      body: formData,
    });
    if (response.ok) {
      setStatus("Commentaire ajoutÃ© !");
      setComment("");
    } else {
      setStatus("Erreur lors de l'envoi.");
    }
  }

  return (
    <div>
      <h1>Ajouter un commentaire</h1>
      <form action={submitComment}>
        <textarea
          name="comment"
          value={comment}
          onChange={(e) => setComment(e.target.value)}
        />
        <button type="submit">Envoyer</button>
      </form>
      <p>{status}</p>
    </div>
  );
}
```
ğŸ›  **Fichier : `app/actions/addComment.ts`**  
```tsx
"use server";

import { db } from "@/lib/db"; // Supposons une connexion Ã  une base de donnÃ©es

export async function addComment(formData: FormData) {
  const comment = formData.get("comment");
  if (!comment) return { error: "Le commentaire est vide." };

  await db.comments.create({ data: { content: comment } });

  return { success: true };
}
```

âœ… **Explication** :
- `submitComment()` appelle lâ€™API `/actions/addComment` via `fetch()`.
- **La logique serveur est dÃ©finie dans `app/actions/addComment.ts`**, non exposÃ©e au client.
- Next.js optimise la communication, **Ã©vite un appel rÃ©seau** si possible.

---

## **ğŸ“Œ 3ï¸âƒ£ ExÃ©cution sans `fetch` (Appels directs)**  

Dans un formulaire **sans Ã©tat client**, on peut directement passer la Server Action dans `action={maFonction}`.  

ğŸ”¹ **Exemple : Formulaire dâ€™inscription**  

ğŸ›  **Fichier : `app/signup/page.tsx`**  
```tsx
import { registerUser } from "@/app/actions/register";

export default function SignupPage() {
  return (
    <form action={registerUser}>
      <input type="text" name="name" placeholder="Nom" required />
      <input type="email" name="email" placeholder="Email" required />
      <button type="submit">S'inscrire</button>
    </form>
  );
}
```
ğŸ›  **Fichier : `app/actions/register.ts`**  
```tsx
"use server";

import { db } from "@/lib/db";

export async function registerUser(formData: FormData) {
  const name = formData.get("name") as string;
  const email = formData.get("email") as string;

  await db.user.create({
    data: { name, email },
  });

  return { success: true };
}
```

âœ… **Avantages** :
- Plus besoin de `fetch()`.
- ExÃ©cution optimisÃ©e cÃ´tÃ© serveur.
- SimplicitÃ© de gestion pour les formulaires.

---

## **ğŸ“Œ 4ï¸âƒ£ Server Actions avec Authentification et SÃ©curitÃ©**  

Les Server Actions permettent aussi dâ€™interagir avec lâ€™authentification.  

ğŸ”¹ **Exemple : Authentification avec NextAuth**  

ğŸ›  **Fichier : `app/actions/login.ts`**  
```tsx
"use server";

import { auth } from "@/lib/auth"; // NextAuth

export async function loginUser(formData: FormData) {
  const email = formData.get("email");
  const password = formData.get("password");

  const user = await auth.verify(email, password);
  if (!user) return { error: "Identifiants incorrects" };

  return { success: true, user };
}
```

âœ… **SÃ©curitÃ© renforcÃ©e** :
- L'authentification reste **cÃ´tÃ© serveur**.
- Pas d'exposition des donnÃ©es sensibles.

---

## **ğŸ“Œ 5ï¸âƒ£ Comparaison avec les API Routes**  

| FonctionnalitÃ© | Server Actions (`use server`) | API Routes (`app/api/*`) |
|----------------|----------------|----------------|
| ğŸ“¡ Mode dâ€™appel | Directement dans le composant | Via un `fetch()` |
| ğŸ”’ SÃ©curitÃ© | Code non exposÃ© au client | Besoin dâ€™une protection manuelle |
| âš¡ Performance | Moins de requÃªtes rÃ©seau | NÃ©cessite un appel HTTP |
| ğŸ—ï¸ SimplicitÃ© | Ã‰criture plus compacte | NÃ©cessite plus de code |
| ğŸ”„ RequÃªtes complexes (Webhooks, APIs tierces) | âŒ Pas recommandÃ© | âœ… AdaptÃ© |

---

## **ğŸ“Œ 6ï¸âƒ£ Quand utiliser Server Actions vs API Routes ?**  

âœ… **Utiliser les Server Actions** quand :
- Vous avez une interaction **directe** avec le serveur.
- Vous traitez **des formulaires simples** (inscription, commentaire, contact...).
- Vous voulez optimiser les requÃªtes et Ã©viter un aller-retour client-serveur.

âŒ **Utiliser les API Routes** quand :
- Vous avez besoin **dâ€™une API publique** pour dâ€™autres services.
- Vous traitez **des webhooks ou des requÃªtes externes**.
- Vous devez **gÃ©rer des authentifications OAuth ou JWT complexes**.

---

## **ğŸ¯ Conclusion : Pourquoi adopter les Server Actions ?**  

ğŸš€ **Les Server Actions simplifient lâ€™interaction client-serveur** en Ã©vitant des API Routes superflues.  

âœ… **Avantages principaux** :
- Meilleure **performance** : moins de requÃªtes HTTP.  
- Code **plus clair** et plus sÃ©curisÃ©.  
- IntÃ©gration facile avec **les formulaires et lâ€™authentification**.  