import { Callout } from 'nextra/components'

# ğŸš€ **Utilisation des Server Actions avec les React Server Components (RSC)**  

Les **<Term word="React">React</Term> Server Components (RSC)** sont un Ã©lÃ©ment clÃ© de lâ€™architecture de <Term word="Next.js">Next.js</Term> 13+ avec le dossier `app/`.  
Ils permettent d'exÃ©cuter du code **cÃ´tÃ© serveur** par dÃ©faut, rÃ©duisant le JavaScript envoyÃ© au client et amÃ©liorant les performances.  
<Callout type='info' emoji={"ğŸ‘‰"}>
**Les Server Actions sont parfaitement intÃ©grÃ©es aux RSC**, offrant une interaction fluide entre le serveur et le client.  
</Callout>
---

## **1ï¸âƒ£ Rappel : Server Components vs Client Components**  

**React Server Components (RSC)**  
- âš¡ ExÃ©cutÃ©s **uniquement** cÃ´tÃ© serveur.  
- âŒ Pas dâ€™accÃ¨s Ã  `useState`, `useEffect`, ni aux Ã©vÃ©nements comme `onClick`.  
- âœ… IdÃ©al pour **rÃ©cupÃ©rer et afficher des donnÃ©es sans surcharge cÃ´tÃ© client**.  

**Client Components (`"use client"`)**  
- âœ… UtilisÃ©s pour lâ€™interactivitÃ© (formulaires, boutons, animations).  
- âš¡ Peuvent **appeler des Server Actions** pour exÃ©cuter du code cÃ´tÃ© serveur.  

---

## **2ï¸âƒ£ Utilisation des Server Actions dans un Server Component**  

Nous allons crÃ©er une page **Server Component** qui affiche des donnÃ©es venant dâ€™une base et permet d'ajouter un Ã©lÃ©ment via une **<Term word="Server Action">Server Action</Term>**.  

```tsx filename="app/actions/todos.ts" copy
"use server";

import { db } from "@/lib/db";

export async function getTodos() {
  return await db.todo.findMany();
}

export async function addTodo(formData: FormData) {
  const title = formData.get("title") as string;
  if (!title) return { error: "Le titre est requis" };

  await db.todo.create({ data: { title } });

  return { success: "TÃ¢che ajoutÃ©e !" };
}
```

---

### **ğŸ“Œ Ã‰tape 1 : Afficher les tÃ¢ches avec un Server Component**  

```tsx filename="app/todos/page.tsx" copy
import { getTodos } from "@/app/actions/todos";

export default async function TodosPage() {
  const todos = await getTodos(); // Appel direct cÃ´tÃ© serveur

  return (
    <div className="max-w-md mx-auto p-4 border rounded-lg shadow-lg">
      <h1 className="text-xl font-bold mb-4">Liste des tÃ¢ches</h1>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id} className="border-b py-2">{todo.title}</li>
        ))}
      </ul>
      <AddTodoForm />
    </div>
  );
}
```

âœ… **Explication** :
- `getTodos()` est **appelÃ© directement** dans le Server Component.  
- Il rÃ©cupÃ¨re **les tÃ¢ches en base de donnÃ©es** **sans utiliser `useEffect` ni `fetch()`**.  
- **Aucune donnÃ©e inutile nâ€™est envoyÃ©e au client**, ce qui optimise les performances.

---

### **ğŸ“Œ Ã‰tape 2 : Ajouter un formulaire avec une Server Action**  
<Callout type="warning" emoji="ğŸš¨">
**Un Server Component ne peut pas gÃ©rer `onSubmit`.**  
Nous devons utiliser un **Client Component** pour gÃ©rer le formulaire.  
</Callout>
```tsx filename="app/todos/AddTodoForm.tsx" copy
"use client";

import { useState } from "react";
import { addTodo } from "@/app/actions/todos";

export default function AddTodoForm() {
  const [status, setStatus] = useState<string | null>(null);

  async function handleSubmit(formData: FormData) {
    const result = await addTodo(formData);
    if (result?.error) setStatus(result.error);
    else setStatus(result.success);
  }

  return (
    <form action={handleSubmit} className="mt-4 space-y-3">
      <input
        type="text"
        name="title"
        placeholder="Nouvelle tÃ¢che"
        className="w-full p-2 border rounded"
        required
      />
      <button type="submit" className="w-full bg-green-500 text-white py-2 rounded">
        Ajouter
      </button>
      {status && <p className="mt-2 text-center">{status}</p>}
    </form>
  );
}
```

âœ… **Explication** :
- `"use client"` rend le <Term word="composant">composant</Term> **interactif**.  
- `handleSubmit` appelle **directement** la Server Action `addTodo`.  
- Pas besoin de `fetch()` ni d'<Term word="API">API</Term> externe.  

---

## **3ï¸âƒ£ RafraÃ®chir automatiquement la liste aprÃ¨s ajout**  

Actuellement, lâ€™ajout fonctionne mais **la liste ne se met pas Ã  jour automatiquement**.  
Nous pouvons utiliser **Server Actions avec `revalidatePath()`** pour forcer la mise Ã  jour des donnÃ©es.  

```tsx filename="app/actions/todos.ts" copy
"use server";

import { db } from "@/lib/db";
import { revalidatePath } from "next/cache";

export async function getTodos() {
  return await db.todo.findMany();
}

export async function addTodo(formData: FormData) {
  const title = formData.get("title") as string;
  if (!title) return { error: "Le titre est requis" };

  await db.todo.create({ data: { title } });

  revalidatePath("/todos"); // ğŸ”¥ Force la mise Ã  jour
  return { success: "TÃ¢che ajoutÃ©e !" };
}
```

âœ… **Effet** :  
DÃ¨s quâ€™une tÃ¢che est ajoutÃ©e, **Next.js rafraÃ®chit automatiquement la page `/todos`** et affiche la nouvelle liste.

---

## **4ï¸âƒ£ Comparaison avec une API Route**  

| ğŸ”¹ MÃ©thode | Server Actions (`use server`) | API Route (`app/api/todos/route.ts`) |
|------------|----------------|----------------|
| ğŸ—ï¸ **ComplexitÃ©** | Plus simple, pas de `fetch()` | NÃ©cessite `fetch()` et API Route |
| âš¡ **Performance** | Moins dâ€™allers-retours rÃ©seau | Requiert un appel <Term word="HTTP">HTTP</Term> |
| ğŸ”’ **SÃ©curitÃ©** | Code non exposÃ© cÃ´tÃ© client | Accessible via `fetch()` |
| ğŸ”„ **RafraÃ®chissement** | Automatique avec `revalidatePath` | Doit Ãªtre gÃ©rÃ© cÃ´tÃ© client |
| ğŸ† **Cas d'usage** | IdÃ©al pour **formulaires et interactions simples** | Utile pour **APIs publiques et webhooks** |

---

## **ğŸ¯ Conclusion : Pourquoi utiliser Server Actions avec RSC ?**  

ğŸš€ **Les Server Actions et React Server Components simplifient le dÃ©veloppement full-stack avec Next.js 13+**.  

âœ… **Avantages** :
- Code **plus simple** et optimisÃ©.
- **Moins de JavaScript cÃ´tÃ© client**, meilleur <Term word="SEO">SEO</Term> et performances.
- **Pas besoin dâ€™API Routes ou de `fetch()`** pour charger les donnÃ©es.
- **Mise Ã  jour automatique** avec `revalidatePath()`.