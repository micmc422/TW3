# ğŸ“Œ **Exercice : Server Actions & Optimistic UI**  

**1ï¸âƒ£ Objectif**  
- ImplÃ©menter un **formulaire de contact** avec une **Server Action**.  
- CrÃ©er un bouton **"Like"** avec une mise Ã  jour **optimiste** et en temps rÃ©el.  

---

## **ğŸ“ Exercice 1 : Formulaire de contact avec une Server Action**  

### **ğŸ“Œ Ã‰tape 1 : CrÃ©ation de la Server Action**  

```tsx filename="app/actions/contact.ts" copy
"use server";

import { revalidatePath } from "next/cache";

export async function sendContactMessage(formData: FormData) {
  const name = formData.get("name") as string;
  const email = formData.get("email") as string;
  const message = formData.get("message") as string;

  if (!name || !email || !message) {
    return { error: "Tous les champs sont requis" };
  }

  await new Promise((resolve) => setTimeout(resolve, 1000)); // Simule un dÃ©lai rÃ©seau

  console.log("Message reÃ§u :", { name, email, message });

  revalidatePath("/contact"); // Facultatif si on veut recharger la page

  return { success: "Message envoyÃ© !" };
}
```

âœ… **Explication** :  
- La fonction rÃ©cupÃ¨re les donnÃ©es du formulaire et simule un envoi.  
- Elle **attend 1 seconde** (simule une requÃªte distante).  
- Elle renvoie un **message de succÃ¨s** ou une **erreur**.  

---

### **ğŸ“Œ Ã‰tape 2 : CrÃ©ation du formulaire cÃ´tÃ© client**  

```tsx filename="app/contact/page.tsx" copy
"use client";

import { useState, useTransition } from "react";
import { sendContactMessage } from "@/app/actions/contact";

export default function ContactPage() {
  const [message, setMessage] = useState("");
  const [isPending, startTransition] = useTransition();

  async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {
    event.preventDefault();
    
    const formData = new FormData(event.currentTarget);
    
    startTransition(async () => {
      const result = await sendContactMessage(formData);
      if (result?.success) {
        setMessage(result.success);
        event.currentTarget.reset(); // RÃ©initialisation du formulaire
      } else {
        setMessage(result.error);
      }
    });
  }

  return (
    <div className="max-w-lg mx-auto p-6 border rounded-lg shadow-lg">
      <h1 className="text-xl font-bold mb-4">Contactez-nous</h1>
      <form onSubmit={handleSubmit} className="space-y-3">
        <input name="name" placeholder="Nom" required className="w-full p-2 border rounded" />
        <input type="email" name="email" placeholder="Email" required className="w-full p-2 border rounded" />
        <textarea name="message" placeholder="Votre message" required className="w-full p-2 border rounded"></textarea>
        <button 
          type="submit" 
          disabled={isPending} 
          className={`w-full py-2 rounded ${isPending ? "bg-gray-400" : "bg-blue-500 text-white"}`}
        >
          {isPending ? "Envoi..." : "Envoyer"}
        </button>
      </form>
      {message && <p className="mt-2 text-center text-green-500">{message}</p>}
    </div>
  );
}
```

âœ… **Explication** :  
- Utilisation de `useTransition()` pour empÃªcher le blocage de lâ€™UI.  
- **Affichage dâ€™un message de succÃ¨s** ou dâ€™erreur.  
- **RÃ©initialisation du formulaire** aprÃ¨s lâ€™envoi.  

---

## **ğŸ“ Exercice 2 : Bouton "Like" avec mise Ã  jour optimiste**  

### **ğŸ“Œ Ã‰tape 1 : CrÃ©ation de la Server Action**  

```tsx filename="app/actions/likes.ts" copy
"use server";

import { revalidatePath } from "next/cache";

let likes = 0; // Simule un compteur en mÃ©moire (Ã  remplacer par une DB)

export async function addLike() {
  likes++;

  await new Promise((resolve) => setTimeout(resolve, 500)); // Simule une requÃªte

  revalidatePath("/likes");
  return likes;
}
```

âœ… **Explication** :  
- On simule un compteur `likes`.  
- Il est **incrÃ©mentÃ©** et la page est **revalidÃ©e** aprÃ¨s 500ms.  

---

### **ğŸ“Œ Ã‰tape 2 : Interface avec mise Ã  jour optimiste**  

```tsx filename="app/likes/page.tsx"
"use client";

import { useOptimistic, useTransition, useState } from "react";
import { addLike } from "@/app/actions/likes";

export default function LikeButton() {
  const [likes, setLikes] = useState(0);
  const [isPending, startTransition] = useTransition();

  // Gestion optimiste des likes
  const [optimisticLikes, setOptimisticLikes] = useOptimistic(
    likes,
    (currentLikes) => currentLikes + 1
  );

  function handleLike() {
    setOptimisticLikes(); // Ajout immÃ©diat en UI
    
    startTransition(async () => {
      const updatedLikes = await addLike();
      setLikes(updatedLikes);
    });
  }

  return (
    <div className="flex flex-col items-center p-6 border rounded-lg shadow-lg">
      <button 
        onClick={handleLike}
        disabled={isPending}
        className={`px-4 py-2 rounded ${isPending ? "bg-gray-400" : "bg-red-500 text-white"}`}
      >
        â¤ï¸ Like ({optimisticLikes})
      </button>
    </div>
  );
}
```

âœ… **Explication** :  
- **Optimistic UI** : Le like **est affichÃ© instantanÃ©ment** en UI.  
- `useTransition()` empÃªche le **blocage du bouton** pendant la requÃªte.  
- Une fois lâ€™action complÃ©tÃ©e, **lâ€™Ã©tat rÃ©el est mis Ã  jour**.  

---

## **ğŸ¯ Conclusion**  

ğŸš€ **Avec ces exercices, vous maÃ®trisez** :  
âœ… **Les Server Actions** pour soumettre et rÃ©cupÃ©rer des donnÃ©es.  
âœ… **`useTransition()`** pour une UI **fluide et rÃ©active**.  
âœ… **`useOptimistic()`** pour une mise Ã  jour **instantanÃ©e et sans latence**.