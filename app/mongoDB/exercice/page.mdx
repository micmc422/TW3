---
description: "Exercice MongoDB."
---
import { FileTree } from 'nextra/components'
import { Callout } from 'nextra/components'
 

# ğŸ§ª MongoDB-TP-TW3

## ğŸ”— Ressources :
- [CodeSandbox](https://codesandbox.io/) est une plateforme en ligne offrant un environnement de dÃ©veloppement collaboratif basÃ© sur le cloud.
  
- L'image Docker officielle de MongoDB peut Ãªtre trouvÃ©e sur le [Hub Docker - MongoDB](https://hub.docker.com/_/mongo), offrant une solution prÃªte Ã  l'emploi pour le dÃ©ploiement de bases de donnÃ©es MongoDB dans des conteneurs Docker.

- [Express](https://www.npmjs.com/package/express/) est un framework web minimaliste et flexible pour Node.js, permettant de crÃ©er des applications web robustes et Ã©volutives.

- [MongoDB](https://www.npmjs.com/package/mongodb/) est un systÃ¨me de gestion de base de donnÃ©es NoSQL orientÃ© document.

- [Body-Parser](https://www.npmjs.com/package/body-parser) est un middleware Node.js facilitant le traitement des donnÃ©es du corps des requÃªtes HTTP dans une application Express.

## ğŸƒ Ã‰tapes :
- CrÃ©er un devBox Node.js sur [codesandBox](https://codesandbox.io/dashboard/recent)
- Utiliser le cours pour installer mongoDB dans le codesandBox, et lancer un container docker mongo.
- Installer les dÃ©pendances (librairies), nÃ©cessaire au projet.
    ```sh npm2yarn copy
    npm i express mongodb body-parser
    ```
- CrÃ©er les fichiers de base du projet :

<FileTree>
  <FileTree.Folder name="node-mongodb-docker" defaultOpen>
    <FileTree.Folder name="src" defaultOpen>
      <FileTree.File name="index.js" />
        <FileTree.Folder name="public" defaultOpen>
        <FileTree.File name="index.html" />
        <FileTree.File name="style.css" />
        <FileTree.File name="script.js" />
        </FileTree.Folder>
  </FileTree.Folder>
    <FileTree.File name="package.json" />
  </FileTree.Folder>
</FileTree>

<Callout type="warning" emoji="âš ï¸">
  Il y a des erreurs dans le code que je vous fourni, principalement du fait que j'ai fait Ã©voluer l'exercice plusieurs fois. Vous allez devoir les identifier pour faire fonctionner le project 
  
  **vous pouvez/devez travailler tous ensembles**
</Callout>
## ğŸƒ CrÃ©ation des fichiers

### ğŸ“‡ public/index.html
```html filename="public/index.html" copy
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Node.js MongoDB Docker</title>
</head>
<body>
  <h1>Hello, MongoDB!</h1>
  <div>
    <label for="dataInput">Data:</label>
    <input type="text" id="dataInput" />
    <button onclick="sendData()">Send Data</button>
  </div>
  <div id="output"></div>
  <script src="script.js"></script>
</body>
</html>
```
### ğŸƒ public/style.css

```css filename="public/style.css" copy
body {
  font-family: Arial, sans-serif;
  margin: 20px;
}

h1 {
  color: #333;
}

div {
  margin-top: 20px;
}

label {
  font-weight: bold;
}

input {
  margin-right: 10px;
}

button {
  cursor: pointer;
}
```
### ğŸƒ public/script.js

```js filename="public/script.js" copy
function sendData() {
  const dataInput = document.getElementById('dataInput');
  const outputDiv = document.getElementById('output');

  const data = dataInput.value;

  // Utilisez fetch pour envoyer des donnÃ©es au serveur
  fetch('/sendData', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ data }),
  })
  .then(response => response.json())
  .then(result => {
    outputDiv.innerText = `Server Response: ${result.message}`;
  })
  .catch(error => {
    console.error('Error sending data:', error);
  });
}
```
### ğŸ“‡ src/index.js
```js filename="src/index.js" copy
const express = require('express');
const { MongoClient } = require('mongodb');
const bodyParser = require('body-parser');

const app = express();
const PORT = process.env.PORT || 3000;

// URL de MongoDB sur le port 27017, le protocole est mongodb:// l'hÃ´te est localhost utilisez les information de configuration de docker comme rÃ©fÃ©rence.
const mongoUrl = 'mongodb://localhost:27017';

// Utilisez bodyParser pour parser les requÃªtes JSON
app.use(bodyParser.json());

// Utilisez express.static pour servir les fichiers statiques
app.use(express.static("src/public"));

// Route pour envoyer des donnÃ©es Ã  l'API
app.post('/addData', async (req, res) => {
  const dataContent = req.body.data;

  try {
    // Ã‰tablir une connexion avec la base de donnÃ©es
    const client = new MongoClient(mongoUrl);
    await client.connect();

    // SÃ©lectionne la base de donnÃ©es et la collection 
    const collection = client.db().collection('data');

    // InsÃ©rer une nouvelle donnÃ©e dans la collection
    await collection.insertOne({ content: dataContent });

    // Fermer la connexion
    await client.close();

    res.json({ message: 'Data added successfully' });
  } catch (error) {
    console.error('Error adding data:', error);
    res.status(500).json({ error: 'Internal Server Error' });
  }
});

// Route pour rÃ©cupÃ©rer des donnÃ©es depuis l'API
app.get("/list", async (req, res) => {
  try {
    // Ã‰tablir une connexion avec la base de donnÃ©es
    const client = new MongoClient(mongoUrl);
    await client.connect();

    // SÃ©lectionner la collection
    const collection = client.db("test").collection("ma_collection");

    // RÃ©cupÃ©rer les donnÃ©es de la collection et les formatter en tableau JSON
    const list = await collection.find().toArray();

    // Fermer la connexion
    await client.close();

    // Renvoyer le tableau JSON Ã  l'utilisateur
    res.json({ list });
  } catch (error) {
    console.error("Error reading data:", error);
    res.status(500).json({ error: "Internal Server Error" });
  }
});

// Route pour rÃ©cupÃ©rer un document depuis l'API
app.get("/etudiant/:id", async (req, res) => {
  const { id } = req.params;
  // Ã  vous de complÃ©ter
});

// Route pour modifier un document depuis l'API
app.post("/edit/:id", async (req, res) => {
  const { id } = req.params;
  // Ã  vous de complÃ©ter
});

// ... (autres routes)

app.listen(PORT, () => {
  console.log(`Example app listening on port ${PORT}`)
})
```

```mermaid copy
flowchart TD
    A[Formulaire] -->|"envoi des donnÃ©es"| B("sendData()")
    B -->|/endpoint| C{Express}
    C -->|connu| D[MongoClient]
    C -->|inconnu| E[Error]
    D -->|RequÃªte| F[MongoDB]
    F -->|RÃ©ponse| C{Express} 
    C -->|Retourne la rÃ©ponse| A{Formulaire} 
```


## ğŸƒ Objectifs

DÃ©velopper le projet crÃ©Ã© en utilisant deux documents (cf: [modÃ©lisation](/mongoDB/modelisation/modelisation)) :

pet et owner pour reprendre le TP prÃ©cÃ©dent, vous pourrez rÃ©utiliser un structure connu et simple, ce qui vous permettra de vous concentrer sur l'essentiel.
