---
description: "Dans ce cas pratique, nous allons explorer comment Docker gÃ¨re le stockage persistant en utilisant deux techniques courantes : les volumes Docker et les bind mounts."
---
import { Steps } from 'nextra/components'

# ğŸ—ƒï¸ Cas Pratique : Stockage Docker

Dans ce cas pratique, nous allons explorer comment <Term word="Docker">Docker</Term> gÃ¨re le stockage persistant en utilisant deux techniques courantes : **les volumes Docker** et **les bind mounts**. Nous allons crÃ©er un <Term word="conteneur">conteneur</Term> qui persiste ses donnÃ©es, mÃªme aprÃ¨s son arrÃªt ou sa suppression.

## ğŸ¯ Objectif

1. Utiliser un **<Term word="volume">volume</Term> Docker** pour persister les donnÃ©es dâ€™un conteneur.
2. Utiliser un **bind mount** pour partager des fichiers entre lâ€™hÃ´te et le conteneur.
3. VÃ©rifier la persistance des donnÃ©es aprÃ¨s la suppression du conteneur.

<Steps>
### ğŸŒ Utiliser un Volume Docker

Les volumes Docker sont gÃ©rÃ©s par Docker lui-mÃªme et sont stockÃ©s dans un rÃ©pertoire dÃ©diÃ© sur lâ€™hÃ´te. Ils permettent de persister des donnÃ©es de maniÃ¨re simple et efficace, tout en Ã©tant indÃ©pendants du cycle de vie des conteneurs.


Avant de commencer, vous pouvez crÃ©er explicitement le volume (optionnel) :

```bash copy
docker volume create mysql-data
```

Nous allons commencer par lancer un conteneur MySQL en utilisant un volume Docker pour persister les donnÃ©es :

```bash copy
docker run -d \
  --name mysql-volume \
  -e MYSQL_ROOT_PASSWORD=rootpassword \
  -v mysql-data:/var/lib/mysql \
  mysql:latest
```

Explications :
- **`-d`** : ExÃ©cute le conteneur en mode dÃ©tachÃ©.
- **`--name mysql-volume`** : Donne un nom au conteneur (facilite les interactions).
- **`-e MYSQL_ROOT_PASSWORD=rootpassword`** : DÃ©finit une variable d'environnement pour le mot de passe root.
- **`-v mysql-data:/var/lib/mysql`** : Monte un volume nommÃ© `mysql-data` dans le rÃ©pertoire `/var/lib/mysql`, oÃ¹ MySQL stocke ses donnÃ©es.


Docker va crÃ©er automatiquement le volume `mysql-data`. Pour vÃ©rifier que le volume a Ã©tÃ© crÃ©Ã©, exÃ©cutez la commande suivante :

```bash copy
docker volume ls
```

Vous devriez voir `mysql-data` dans la liste des volumes.

### ğŸ”„ VÃ©rifier la Persistance des DonnÃ©es avec le Volume

Nous allons maintenant arrÃªter et supprimer le conteneur MySQL, puis le relancer pour vÃ©rifier que les donnÃ©es sont bien persistÃ©es.

1. **ArrÃªter et supprimer le conteneur** :

```bash copy
docker stop mysql-volume
docker rm mysql-volume
```

2. **Relancer un conteneur avec le mÃªme volume** :

```bash copy
docker run -d \
  --name mysql-volume \
  -e MYSQL_ROOT_PASSWORD=rootpassword \
  -v mysql-data:/var/lib/mysql \
  mysql:latest
```

Le conteneur MySQL va redÃ©marrer en utilisant les mÃªmes donnÃ©es que prÃ©cÃ©demment, prouvant que le volume a bien persistÃ© les informations de la base de donnÃ©es.

### ğŸ“‚ Utiliser un Bind Mount

Un **bind mount** permet de lier un rÃ©pertoire spÃ©cifique de la machine hÃ´te Ã  un rÃ©pertoire du conteneur. Cela peut Ãªtre utile pour partager des fichiers de configuration, du code source ou dâ€™autres donnÃ©es entre lâ€™hÃ´te et le conteneur.

Nous allons maintenant monter un rÃ©pertoire de notre machine locale dans un conteneur Nginx.

1. **CrÃ©er un fichier sur la machine hÃ´te** :

CrÃ©ez un rÃ©pertoire sur votre machine hÃ´te contenant une page HTML simple.

```bash copy
mkdir ~/nginx-html
echo "<h1>Hello from Docker Bind Mount</h1>" > ~/nginx-html/index.html
```

2. **Lancer un conteneur Nginx avec un bind mount** :

```bash copy
docker run -d \
  --name nginx-bind \
  -p 8080:80 \
  -v ~/nginx-html:/usr/share/nginx/html \
  nginx
```

Explications :
- **`-p 8080:80`** : Redirige le port 8080 de la machine hÃ´te vers le port 80 du conteneur.
- **`-v ~/nginx-html:/usr/share/nginx/html`** : Lie le rÃ©pertoire local `~/nginx-html` au rÃ©pertoire oÃ¹ Nginx sert les fichiers HTML dans le conteneur (`/usr/share/nginx/html`).

3. **AccÃ©der Ã  la page web** :

Ouvrez votre navigateur et accÃ©dez Ã  `http://localhost:8080`. Vous devriez voir la page HTML que vous avez crÃ©Ã©e sur votre machine hÃ´te, prouvant que le bind mount fonctionne.

### ğŸ”„ VÃ©rifier le Fonctionnement du Bind Mount

Modifiez le fichier `index.html` sur votre machine locale :

```bash copy
echo "<h1>Updated from Host</h1>" > ~/nginx-html/index.html
```

RafraÃ®chissez votre navigateur. Vous verrez immÃ©diatement la mise Ã  jour, car le conteneur utilise directement le fichier stockÃ© sur votre machine.

### ğŸ§¹ Nettoyage

docker rm mysql-volume nginx-bind
docker volume rm mysql-data

Une fois terminÃ©, vous pouvez arrÃªter et supprimer les conteneurs et volumes avec ces commandes :

```bash copy
docker stop mysql-volume nginx-bind
docker rm mysql-volume nginx-bind
docker volume rm mysql-data
```

Vous pouvez Ã©galement supprimer le dossier local utilisÃ© pour le bind mount si vous n'en avez plus besoin :

```bash copy
rm -rf ~/nginx-html
```

</Steps>

## ğŸ“ Conclusion

Dans ce cas pratique, nous avons explorÃ© deux mÃ©canismes de stockage Docker : **les volumes**, qui permettent de garantir la persistance des donnÃ©es indÃ©pendamment du cycle de vie des conteneurs, et **les bind mounts**, qui facilitent le partage direct de fichiers entre lâ€™hÃ´te et les conteneurs. Ces techniques sont essentielles pour dÃ©velopper des applications nÃ©cessitant la persistance des donnÃ©es et lâ€™intÃ©gration continue avec les systÃ¨mes de fichiers locaux.