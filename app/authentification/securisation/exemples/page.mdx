---
description: "Dans cette activit√©, nous allons prendre un formulaire de connexion de base et y appliquer des bonnes pratiques pour renforcer sa s√©curit√©. L'objectif est de pr√©venir les attaques courantes comme le XSS, le CSRF, et le brute force, tout en prot√©geant les donn√©es utilisateur."
---
# üîí **Activit√© Pratique : Renforcement de la S√©curit√© d‚Äôun Formulaire de Connexion**

Dans cette activit√©, nous allons prendre un formulaire de connexion de base et y appliquer des bonnes pratiques pour renforcer sa s√©curit√©. L'objectif est de pr√©venir les attaques courantes comme le **XSS**, le **CSRF**, et le **brute force**, tout en prot√©geant les donn√©es utilisateur.

---

## üîê **Pr√©paration du Formulaire de Connexion de Base**

**Code HTML de d√©part :**
```html copy
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion</title>
</head>
<body>
    <form id="loginForm" action="/login" method="POST">
        <label for="username">Nom d'utilisateur :</label>
        <input type="text" id="username" name="username" required>
        
        <label for="password">Mot de passe :</label>
        <input type="password" id="password" name="password" required>
        
        <button type="submit">Se connecter</button>
    </form>
</body>
</html>
```

**Code Node.js de d√©part :**
```javascript copy
const express = require('express');
const bodyParser = require('body-parser');
const app = express();

app.use(bodyParser.urlencoded({ extended: true }));

app.post('/login', (req, res) => {
    const { username, password } = req.body;
    // V√©rification des identifiants (exemple fictif)
    if (username === 'admin' && password === 'password123') {
        res.send('Connexion r√©ussie');
    } else {
        res.status(401).send('Nom d‚Äôutilisateur ou mot de passe incorrect');
    }
});

app.listen(3000, () => {
    console.log('Serveur en cours d‚Äôex√©cution sur http://localhost:3000');
});
```

Ce formulaire fonctionne, mais il est vuln√©rable √† plusieurs attaques. Nous allons maintenant y ajouter des mesures de s√©curit√©.

---

## üîê **Mesures de S√©curisation**

### üîí **a. Protection contre les Attaques XSS**

**Vuln√©rabilit√© XSS :**  
Les attaquants peuvent injecter des scripts malveillants dans les champs de formulaire, qui s'ex√©cuteront sur le navigateur de la victime.

**Solution :**  
- Valider et √©chapper toutes les entr√©es utilisateur c√¥t√© serveur.  
- Ajouter une **Content Security Policy (CSP)** pour restreindre les sources de scripts.

**Mise en ≈ìuvre dans Node.js :**
```javascript copy
const sanitizeHtml = require('sanitize-html');

app.post('/login', (req, res) => {
    const username = sanitizeHtml(req.body.username);
    const password = sanitizeHtml(req.body.password);

    if (username === 'admin' && password === 'password123') {
        res.send('Connexion r√©ussie');
    } else {
        res.status(401).send('Nom d‚Äôutilisateur ou mot de passe incorrect');
    }
});
```

**Ajout d‚Äôune CSP dans les headers HTTP :**
```javascript copy
app.use((req, res, next) => {
    res.setHeader(
        'Content-Security-Policy',
        "default-src 'self'; script-src 'self'; style-src 'self';"
    );
    next();
});
```

---

### üîí **b. Protection contre les Attaques CSRF**

**Vuln√©rabilit√© CSRF :**  
Un attaquant peut forcer un utilisateur authentifi√© √† envoyer une requ√™te malveillante (par exemple, en cliquant sur un lien malicieux).

**Solution :**  
- Utiliser des jetons CSRF pour valider que chaque requ√™te POST provient de l‚Äôutilisateur l√©gitime.  

**Installation et utilisation de `csurf` :**
```bash copy
npm install csurf cookie-parser
```

**Ajout dans l‚Äôapplication :**
```javascript copy
const cookieParser = require('cookie-parser');
const csrf = require('csurf');

app.use(cookieParser());
app.use(csrf({ cookie: true }));

app.get('/login', (req, res) => {
    res.send(`
        <form id="loginForm" action="/login" method="POST">
            <input type="hidden" name="_csrf" value="${req.csrfToken()}">
            <label for="username">Nom d'utilisateur :</label>
            <input type="text" id="username" name="username" required>
            
            <label for="password">Mot de passe :</label>
            <input type="password" id="password" name="password" required>
            
            <button type="submit">Se connecter</button>
        </form>
    `);
});

app.post('/login', (req, res) => {
    const { username, password } = req.body;
    if (username === 'admin' && password === 'password123') {
        res.send('Connexion r√©ussie');
    } else {
        res.status(401).send('Nom d‚Äôutilisateur ou mot de passe incorrect');
    }
});
```

---

### üîê **c. Limitation des Attaques par Force Brute**

**Vuln√©rabilit√© :**  
Les attaquants peuvent essayer plusieurs combinaisons de mots de passe jusqu‚Äô√† en trouver un correct.

**Solution :**  
- Limiter le nombre de tentatives de connexion.  
- Impl√©menter un d√©lai ou un blocage temporaire apr√®s plusieurs √©checs.

**Installation et utilisation de `express-rate-limit` :**
```bash copy
npm install express-rate-limit
```

**Ajout dans l‚Äôapplication :**
```javascript copy
const rateLimit = require('express-rate-limit');

const loginLimiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 5, // Limite √† 5 tentatives
    message: 'Trop de tentatives de connexion. R√©essayez plus tard.',
});

app.post('/login', loginLimiter, (req, res) => {
    const { username, password } = req.body;
    if (username === 'admin' && password === 'password123') {
        res.send('Connexion r√©ussie');
    } else {
        res.status(401).send('Nom d‚Äôutilisateur ou mot de passe incorrect');
    }
});
```

---

### üç™ **d. Utilisation de Cookies S√©curis√©s**

**Vuln√©rabilit√© :**  
Les cookies peuvent √™tre vol√©s via des attaques XSS ou envoy√©s sur des connexions non s√©curis√©es.

**Solution :**  
- Ajouter les options `HttpOnly`, `Secure`, et `SameSite` aux cookies de session.

**Exemple :**
```javascript copy
const session = require('express-session');

app.use(session({
    secret: 'votre_secret',
    resave: false,
    saveUninitialized: true,
    cookie: {
        httpOnly: true,
        secure: false, // Passez √† true si vous utilisez HTTPS
        sameSite: 'strict',
    },
}));
```

---

## üîê **R√©sultat Final**

Avec ces am√©liorations, notre formulaire de connexion est d√©sormais prot√©g√© contre :  
1. **XSS** : Validation des entr√©es et ajout d‚Äôune CSP.  
2. **CSRF** : Impl√©mentation de jetons CSRF.  
3. **Attaques par force brute** : Limitation des tentatives de connexion.  
4. **Vol de session** : Cookies s√©curis√©s.  

---

**Tester l‚Äôapplication :**  
1. Lancez le serveur :  
   ```bash copy
   node app.js
   ```
2. Acc√©dez √† `http://localhost:3000/login` pour tester le formulaire s√©curis√©.  
3. Effectuez des tests avec des attaques simul√©es (par exemple, en injectant des scripts ou en envoyant plusieurs requ√™tes incorrectes).

Ces bonnes pratiques renforcent significativement la s√©curit√© des syst√®mes d‚Äôauthentification tout en maintenant une exp√©rience utilisateur fluide.