---
description: "Dans cette activitÃ©, nous allons mettre en place une authentification OAuth 2.0 en utilisant Google comme fournisseur d'identitÃ© (IdP). L'application permettra aux utilisateurs de se connecter avec leur compte Google."
---
import { Steps } from 'nextra/components'

# ğŸ”’ **ActivitÃ© Pratique : ImplÃ©mentation dâ€™une Authentification OAuth 2.0 avec Google**

Dans cette activitÃ©, nous allons mettre en place une authentification <Term word="OAuth">OAuth</Term> 2.0 en utilisant **Google** comme fournisseur d'identitÃ© (IdP). L'application permettra aux utilisateurs de se connecter avec leur compte Google.  

<Steps>

## ğŸ› ï¸ **Configuration de lâ€™application Google**
<Steps>
### ğŸ” **AccÃ©der Ã  la Console Google Cloud :**
   Rendez-vous sur [Google Cloud Console](https://console.cloud.google.com/) et connectez-vous avec votre compte Google.

### ğŸ” **CrÃ©er un projet :**
   - Cliquez sur **"CrÃ©er un projet"**. Donnez-lui un nom, puis cliquez sur **"CrÃ©er"**.

### ğŸ› ï¸ **Configurer lâ€™OAuth Consent Screen (Ã©cran de consentement OAuth) :**
   - Allez dans **"<Term word="API">API</Term> & Services" â†’ "Consentement OAuth"**.  
   - Choisissez **type externe** si vous souhaitez permettre Ã  d'autres utilisateurs d'utiliser votre application.  
   - Remplissez les champs requis, comme le nom de l'application et votre email.  
   - Enregistrez.

### ğŸ”’ **CrÃ©er des identifiants OAuth 2.0 :**
   - Rendez-vous dans **"Identifiants" â†’ "CrÃ©er des identifiants" â†’ "Identifiants OAuth 2.0"**.  
   - SÃ©lectionnez **Application web** comme type.  
   - Configurez les **URI de redirection** (callback <Term word="URL">URL</Term>) :  
     Par exemple :  
     ```
     http://localhost:3000/auth/google/callback
     ```
   - Cliquez sur **CrÃ©er** et notez votre **Client ID** et **Client Secret**.
</Steps>

## ğŸ” **Initialiser le Projet Node.js**
<Steps>
### ğŸ” **CrÃ©er un projet Node.js :**
   ```bash copy
   mkdir oauth2-google-auth
   cd oauth2-google-auth
   npm init -y
   npm install express passport passport-google-oauth20 express-session dotenv
   ```

### ğŸ› ï¸ **Configurer lâ€™environnement :**
   CrÃ©ez un fichier `.env` pour stocker vos identifiants OAuth :  
   ```plaintext copy
   GOOGLE_CLIENT_ID=<votre_client_id>
   GOOGLE_CLIENT_SECRET=<votre_client_secret>
   SESSION_SECRET=<votre_session_secret>
   CALLBACK_URL=http://localhost:3000/auth/google/callback
   ```
</Steps>

## ğŸ” **Ã‰crire le Code de lâ€™Application**

**CrÃ©er un fichier `app.js` :**

```javascript copy
const express = require('express');
const passport = require('passport');
const GoogleStrategy = require('passport-google-oauth20').Strategy;
const session = require('express-session');
require('dotenv').config();

const app = express();

// Configuration de la session
app.use(session({
    secret: process.env.SESSION_SECRET,
    resave: false,
    saveUninitialized: true,
}));

// Initialisation de Passport
app.use(passport.initialize());
app.use(passport.session());

// Configuration de Passport avec Google OAuth
passport.use(new GoogleStrategy({
    clientID: process.env.GOOGLE_CLIENT_ID,
    clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    callbackURL: process.env.CALLBACK_URL,
}, (accessToken, refreshToken, profile, done) => {
    // Stocker le profil utilisateur
    return done(null, profile);
}));

// SÃ©rialiser les donnÃ©es utilisateur dans la session
passport.serializeUser((user, done) => {
    done(null, user);
});

// DÃ©sÃ©rialiser les donnÃ©es utilisateur depuis la session
passport.deserializeUser((user, done) => {
    done(null, user);
});

// Route principale
app.get('/', (req, res) => {
    res.send(`<h1>Bienvenue</h1><a href="/auth/google">Se connecter avec Google</a>`);
});

// Route pour dÃ©marrer lâ€™authentification avec Google
app.get('/auth/google', passport.authenticate('google', {
    scope: ['profile', 'email'],
}));

// Route de callback aprÃ¨s l'authentification
app.get('/auth/google/callback', 
    passport.authenticate('google', { failureRedirect: '/' }),
    (req, res) => {
        res.redirect('/dashboard');
    }
);

// Route protÃ©gÃ©e : tableau de bord
app.get('/dashboard', (req, res) => {
    if (!req.isAuthenticated()) {
        return res.redirect('/');
    }
    res.send(`<h1>Bonjour, ${req.user.displayName}!</h1><a href="/logout">Se dÃ©connecter</a>`);
});

// DÃ©connexion
app.get('/logout', (req, res) => {
    req.logout(() => {
        res.redirect('/');
    });
});

// Lancer le serveur
const PORT = 3000;
app.listen(PORT, () => {
    console.log(`Serveur en cours dâ€™exÃ©cution sur http://localhost:${PORT}`);
});
```

---

## ğŸ” **Tester lâ€™Application**
<Steps>
### ğŸ” **Lancer le serveur :**
   ```bash copy
   node app.js
   ```

### ğŸ” **AccÃ©der Ã  lâ€™application :**
   Ouvrez votre navigateur et rendez-vous sur [http://localhost:3000](http://localhost:3000).  
   - Cliquez sur **"Se connecter avec Google"**.
   - Connectez-vous avec votre compte Google.  
   - Une fois authentifiÃ©, vous serez redirigÃ© vers le tableau de bord qui affichera votre nom.  
</Steps>

---
</Steps>

## ğŸ” **Explications Techniques**
**Passport.js :**  
   - Un <Term word="middleware">middleware</Term> dâ€™authentification pour <Term word="Node.js">Node.js</Term>.  
   - La stratÃ©gie `passport-google-oauth20` est utilisÃ©e pour intÃ©grer OAuth 2.0 avec Google.

**Sessions avec <Term word="Express">Express</Term> :**  
   - Les informations utilisateur sont stockÃ©es dans une <Term word="session">session</Term> pour persister entre les requÃªtes.

**Callback URL :**  
   - Le point dâ€™entrÃ©e oÃ¹ Google redirige aprÃ¨s lâ€™authentification.  
   - Cette URL doit Ãªtre enregistrÃ©e dans les paramÃ¨tres OAuth de Google.

---

## ğŸ” **Allez plus loin**
- Ajouter une base de donnÃ©es pour stocker les utilisateurs.  
- ProtÃ©ger les routes avec des middlewares pour vÃ©rifier si un utilisateur est authentifiÃ©.  
- IntÃ©grer d'autres fournisseurs (GitHub, Facebook).  

Cette activitÃ© pratique vous permet de comprendre le fonctionnement dâ€™OAuth 2.0 et dâ€™implÃ©menter un flux dâ€™authentification sÃ©curisÃ© et moderne. 