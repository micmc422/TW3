# ğŸ”„ Navigation Programmatique avec React Router

La navigation programmatique dÃ©clenche un changement de route par le code (<Term word="hook">hook</Term> ou <Term word="API">API</Term>) plutÃ´t que par un lien `<Link>`. Utile pour : redirection postâ€‘authentification, retour aprÃ¨s annulation, Ã©tape suivante dâ€™un wizard, gestion dâ€™erreurs.

## ğŸ§  Fondamentaux
`useNavigate()` retourne une fonction `navigate(to, options?)` qui pousse une entrÃ©e dans lâ€™historique (par dÃ©faut). Options clÃ©s : `{ replace: true, state: any }`.

### ğŸ“¦ Exemple minimal
```jsx copy filename="Redirection aprÃ¨s formulaire"
import { useNavigate } from 'react-router';

function FormComponent() {
  const navigate = useNavigate();
  function handleSubmit(e) {
    e.preventDefault();
    // ... traitement
    navigate('/success');
  }
  return <form onSubmit={handleSubmit}>{/* champs */}</form>;
}
```

### â™»ï¸ Remplacer l'entrÃ©e d'historique
Lorsque lâ€™on ne veut pas que lâ€™utilisateur revienne sur la page prÃ©cÃ©dente (ex: aprÃ¨s login).
```jsx copy filename="replace"
navigate('/dashboard', { replace: true });
```

### ğŸ“¦ Passer un Ã©tat de navigation
Transmettre des donnÃ©es Ã©phÃ©mÃ¨res sans polluer lâ€™<Term word="URL">URL</Term>.
```jsx copy filename="State de navigation"
navigate('/checkout', { state: { fromCart: true, total: 42.9 } });
```
Dans la cible :
```jsx copy filename="Lecture state"
import { useLocation } from 'react-router';
const { state } = useLocation();
```

### ğŸ” Navigation relative & historique
```jsx copy filename="Historique"
navigate(-1); // revenir en arriÃ¨re
navigate(1);  // aller en avant (si entrÃ©e disponible)
```

### ğŸš¦ Guards & conditions
Rediriger si condition non respectÃ©e (auth, rÃ´le, donnÃ©es).
```jsx copy filename="Guard simple"
function Protected({ isAuth }) {
  const navigate = useNavigate();
  if (!isAuth) {
    navigate('/login', { replace: true });
    return null;
  }
  return <p>Zone protÃ©gÃ©e</p>;
}
```

### ğŸªœ Combiner avec paramÃ¨tres
```jsx copy filename="ParamÃ¨tre dynamique"
function GoUser({ id }) {
  const navigate = useNavigate();
  return <button onClick={() => navigate(`/users/${id}`)}>Voir user {id}</button>;
}
```

### ğŸ§ª Gestion d'erreur + redirection
```jsx copy filename="Redirection erreur"
try {
  await submitData(form);
  navigate('/done');
} catch (e) {
  navigate('/error', { state: { message: e.message } });
}
```

### ğŸ›¡ï¸ AccessibilitÃ©
AprÃ¨s navigation programmÃ©e vers une vue structurÃ©e, placer le focus sur un titre ou un <Term word="conteneur">conteneur</Term>.
```jsx copy filename="Focus aprÃ¨s navigation"
useEffect(() => { document.getElementById('page-title')?.focus(); }, []);
```
Utiliser `tabIndex="-1"` sur le titre ciblÃ© pour autoriser le focus.

### ğŸ’¤ Lazy + navigate
Fonctionne si la route cible est lazy : la transition charge le chunk nÃ©cessaire.

---

## ğŸ› ï¸ Exercices
1. AprÃ¨s login simulÃ©, rediriger vers `/profil` avec `replace`.  
2. Ajouter un bouton Â« Revenir Â» qui dÃ©sactive si historique vide (tester `window.history.length`).  
3. Passer un Ã©tat `{ flash: 'Profil mis Ã  jour' }` puis lâ€™afficher et lâ€™effacer.  
4. ImplÃ©menter une redirection automatique vers `/login` si token absent.

```jsx copy filename="Base d'exercice"
import { BrowserRouter, Routes, Route, useNavigate, useLocation } from 'react-router';

function Login() {
  const navigate = useNavigate();
  function handleLogin() {
    // fake token
    localStorage.setItem('token', 'abc');
    navigate('/profil', { replace: true, state: { flash: 'Bienvenue !' } });
  }
  return <button onClick={handleLogin}>Se connecter</button>;
}

function Profil() {
  const { state } = useLocation();
  return <div>{state?.flash && <p>{state.flash}</p>}<h2>Profil</h2></div>;
}

function Guard({ children }) {
  const navigate = useNavigate();
  const token = localStorage.getItem('token');
  useEffect(() => { if (!token) navigate('/login', { replace: true }); }, [token, navigate]);
  return token ? children : null;
}

export default function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/login" element={<Login />} />
        <Route path="/profil" element={<Guard><Profil /></Guard>} />
      </Routes>
    </BrowserRouter>
  );
}
```

---

## ğŸ“š Ressources
- API navigate : https://reactrouter.com/en/main/hooks/use-navigate
- Location & <Term word="state">state</Term> : https://reactrouter.com/en/main/hooks/use-location
- AccessibilitÃ© focus <Term word="SPA">SPA</Term> : https://www.w3.org/WAI/ARIA/apg/practices/landmarks/

---

## âš¡ TLDR
- `useNavigate()` pour dÃ©clencher navigation
- `navigate(to, { replace, state })` pour options
- `navigate(-1)` / `navigate(1)` pour historique
- Guards : vÃ©rifier auth puis rediriger (souvent `replace: true`)
- Focus manuel aprÃ¨s navigation pour accessibilitÃ©
- Ã‰viter redirections dans rendu profond sans condition claire

---

Voir aussi : /react/routage/dynamiques pour paramÃ¨tres et /react/donnees pour chargement conditionnel.